---
title: "Tutorial 2 - Data wrangle with `data.table`"
author: "Author: Matthew J. Cossley"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    toc_depth: 3
    fig_caption: yes
    # code_folding: show
    number_sections: false
    theme: cosmo
fontsize: 14pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, collapse=T)
```

## Learning objectives

* Be able to define **independent variables** and
**dependent variables**.

* Get lots of hands-on practice with `R` and `data.table`.

* In particular, master the use of the following functions:
  * `ls`
  * `rm`
  * `str`
  * `is.na` as well as the `NA` `logical` keyword.
  * `mean`
  * `median`
  * `sd`
  * `fread`
  
* You should also pay very careful attention to learn about:  
  * `data.table` chaining
  * Adding columns using `:=`
  * Selecting rows with `i`, operating on columns with `j`,
  and grouping with `by` using `data.table` syntax `[i, j,
  by]`

## Get some experiment data
* Complete the experiment located at the following address:
`https://run.pavlovia.org/demos/simplertt/`

* Be sure to enter your name or some other ID that you will
remember and can be easily searched for.

* Download your data in a `.csv` file by taking the following steps:

* Go here: `https://gitlab.pavlovia.org/demos/simplertt`

* Read about the experiment you just participated in by
scrolling to the bottom and reading the `README.md` file.

* Click the `data` folder to land at the following address:
`https://gitlab.pavlovia.org/demos/simplertt/tree/master/data`

* Near the top right of the page, click the `Find file`
button, and search for a file containing the unique ID that
you entered at the beginning of the experiment.

* Click on the `.csv` file that pops up.

* Finally, click the `download` button to download your
`.csv` file to your local machine.


## Get ready to analyse your data
* If you haven't done so already, create a new folder on
your computer named `cogs2020`

* Open Rstudio and click `File > New File > R Script`

* In Rstudio click `File > Save`

* In the prompt that comes up, name your file
`tutorial_2_notes.R`, and save it in your `cogs2020` folder.

* Move the `.csv` file you just downloaded into your
`cogs2020` folder.


## Analyse your data using `data.table`
* Load the `data.table` library and `rm` to be sure your are
starting with a clean work space.
```{r}
library(data.table)

rm(list = ls())
```

* Load the data into a `data.table` using the `fread`
function from the `data.table` library.
```{r}
# my data lives within a subfolder named `data` so I need
# the following:
d <- fread('./data/data_mjc_simpleRTT_2022-02-26_05h13.22.csv')

# If your data lives in the same directory as your code,
# then you would use:
# d <- fread('data_mjc_simpleRTT_2022-02-26_05h13.22.csv')
```

* We can see that `d` has quite a few columns by printing it
to the console (which I won't do here because the output is
very ugly and I want to keep things clean). You, however,
should do it, so you can see what I mean.

* When `data.table` objects have lots of columns, `str` can
be a good summary function to use for basic inspection.

```{r}
str(d)
```

* It's certainly difficult to know what all of these columns
encode. This is something you will get used to as you build
and run your own experiments (e.g., as you will in later
COGS units). For now, I'll just tell you. The data contains
a row for every trial completed, including practice trials.
You can tell which rows correspond to practice trials and
which correspond to experiment trials by examining the
columns named `practiceTrials.thisN` and `mainTrials.thisN`.

```{r}
d[, .(practiceTrials.thisN, mainTrials.thisN)]
```

* We can see that `mainTrials.thisN` is `NA` during practice
and `practiceTrials.thisN` is `NA` during the main
experiment.

* We can also see that our reaction time per trial is stored
in a column named `response.rt` and the inter-stimulus
interval (isi) is stored in a column named `isi`.

* `response.rt` is our main **dependent variable** of
interest, and `isi` is an **independent variable**

* A **dependent variable* is a variable or outcome not
controlled by the experimenter but rather observed in the
experiment.

* An **independent variable** is a variable or experiment
factor controlled by the experimenter that may influence
observations from a dependent variable.

* Okay, we are now equipped to pull out just the rows and
columns that we need for a simple exploration of our
performance.

```{r}
# Report basic descriptive statistics for the main
# experiment
d_main <- d[!is.na(mainTrials.thisN), .(response.rt, isi)]

d_main[, .(rt_mean=mean(response.rt), 
           rt_median=median(response.rt), 
           rt_sd=mean(response.rt))]

# Report basic descriptive statistics for the main
# experiment using `chaining` to avoid creating a new
# data.table
d[!is.na(mainTrials.thisN), .(response.rt, isi)][, .(rt_mean=mean(response.rt), 
                                                     rt_median=median(response.rt), 
                                                     rt_sd=mean(response.rt))]

# Report basic descriptive statistics for the practice
# trials using `chaining` to avoid creating a new data.table
d[!is.na(practiceTrials.thisN), .(response.rt, isi)][, .(rt_mean=mean(response.rt), 
                                                         rt_median=median(response.rt), 
                                                         rt_sd=mean(response.rt))]
```

* Report basic descriptive statistics for practice and for
the main experiment at the same time. To do this, it will
very helpful to have a new single column that indicates
whether a particular row id `d` corresponds to a practice
trial or to a main trial.
```{r}
d[, phase := "Unknown"]
d[!is.na(practiceTrials.thisN), phase := "practice"]
d[!is.na(mainTrials.thisN), phase := "main"]

d[, .(phase, response.rt)]
```

* The reason having this new column helps so much is because
we can now use it to `group` descriptive statistics as
follows:
```{r}
d[, .(rt_mean=mean(response.rt), 
      rt_median=median(response.rt), 
      rt_sd=mean(response.rt)), 
  .(phase)]
```

* From here, can you report these descriptive statistics for
`isi` without my code to assist?

## Work on problem set 2
* [Problem set 2](homework_2.html)

## Consult Lecture 2 example code
* [Lecture 2](lecture_2.html)