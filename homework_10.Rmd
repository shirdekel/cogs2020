---
title: "Homework 10"
author: "Author: Matthew J. Cossley"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: true
    toc_float:
        collapsed: false 
        smooth_scroll: true
    toc_depth: 3
    fig_caption: yes
    number_sections: false
    theme: cosmo
fontsize: 14pt
---

```{r global-options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE)
```

```{r setup, include=FALSE, message=F}
knitr::opts_chunk$set(echo = T, collapse=T, warning=F)
```

<style type="text/css">
  body{
  font-size: 18pt;
}

<style type="text/css">
.table {

    width: 40%;
}
</style>

```{r, echo=F}
library(data.table)
library(ggplot2)
library(ggpubr)
library(latex2exp)
```

* Create a new file named `cogs2020_hw_10.R` and save it in
the `cogs2020` folder that you created during Lecture 1.

* If you have not already installed the `data.table`,
`ggplot2`, and `ez` packages, do so now. If you use the
`install.packages` function, do not include it in the script
that you hand in.

* Make the first line of your script `library(data.table)`
the second line `library(ggplot2)`, and the third line
`library(ez)`.

* Make the next line of your script `rm(list=ls())`. This
line of code will erase any variable defined before it. Do
not put this line of code after anything important that you
want to keep (e.g., so that I can mark your work).

* After `rm(list=ls())`, create a variable named `my_name`
and set its value equal to a **character** vector (i.e.,
letters surrounded by `""` or by `''`) containing your name.

* After `rm(list=ls())`, create a variable named
`my_student_id` and set its value equal to a **character**
vector (i.e., letters surrounded by `""` or by `''`)
containing your student id.

* So far, here is what your file should look like if your
name is `John Doe` and and your student ID is `12345678`.
Note that the following code chunk also includes a few lines
to create a `data.table` named `d` that many of the problems
below require you manipulate.

```{r, echo=T, warning=F, message=F}
# load the packages we will need
library(data.table)
library(ggplot2)
library(ez)

# clean session
rm(list=ls())

# basic id info
my_name <- "John Doe"
my_student_id <- "12345678"

# Please include the following line of code as well
set.seed(0)
```

# COGS2020 goals
Below, I summarise some major goals of COGS2020 and explain
how they contribute to overall marking in the unit. Only
mastery of skills described in all goals should be
sufficient to earn a mark of high distinction.

## Goal 1 
A major goal of COGS2020 is to prepare students to get data
from an experiment, assess / validate, cross-reference its
design, make relevant diagnostic plots, and perform basic
statistics to quantify patterns seen in the visualisations
of the data. Mastery of this skill implies at least some
mastery of Goal 3 (see below) and so it is expected should
be sufficient to generate a credit or distinction mark.

## Goal 2
A major goal of COGS2020 is to develop in students a deep
conceptual understanding of Null Hypothesis Significance
Testing (NHST). Students with an understanding at this level
will be well positioned to learn any and every NHST method
that can ever be applied in any context throughout their
research career. Mastery of this skill implies mastery of
Goal 3 (see below) and so it is expected should be
sufficient to generate a credit or distinction mark.
  
## Goal 3 
A sub-goal of COGS2020 is to give students the ability to
recognise when and how to use simple statistical tools
(e.g., t-tests and ANOVAs) in the context of simple toy data
examples. Mastery of this skill alone should be sufficient
to generate a passing mark in the unit.

# Goal 1 practice
## Stroop experiment

Consider the experiment here:

* `https://gitlab.pavlovia.org/demos/stroop`
* `https://run.pavlovia.org/demos/stroop/`

You should participate in the experiment to get a feel for
it.

Reasonably cleaned data from this experiment can be found
here: 

* `../data/real_data/data_stroop.csv`

`data_stroop.csv` contains the following columns:

* `subject`: participant indicator
* `resp.keys`: the key pressed
* `resp.rt`: the response time of the key press
* `text`: the text displayed
* `letterColor`: the colour of the displayed text

```{r}
## Analyse the Stroop data

## Load data_stroop.csv into a data.table
d <- fread('https://crossley.github.io/cogs2020/data/real_data/data_stroop.csv')

## Make a violin plot that contains one box indicating the
## response time on congruent (i.e., `text == letterColor`)
## trials and another violin indicating the response time on
## incongruent (i.e., `text != letterColor`) trials. Make
## sure that each subject contributes only one data point
## (i.e., their mean response time on the desired trial
## type) to each box.
d[, trial_type := 'NA']
d[text == letterColor, trial_type := 'congruent']
d[text != letterColor, trial_type := 'incongruent']

dd <- d[, 
        .(rt_mean = mean(resp.rt), rt_err = sd(resp.rt)/sqrt(.N)), 
        .(subject, trial_type)]

ggplot(data=dd, aes(x=trial_type, y=rt_mean)) +
  geom_violin() + 
  geom_point()

## Make a point range plot that plots a point at the mean
## value for each trial type and extends error bars in one
## standard error above and below these mean values.
ddd <- dd[, 
         .(rt_mean = mean(rt_mean), rt_err = sd(rt_mean)/sqrt(.N)),
         .(trial_type)]
ggplot(data=ddd, aes(x=trial_type, y=rt_mean)) +
  geom_pointrange(aes(ymin=rt_mean-rt_err, ymax=rt_mean+rt_err))

## Are the mean response times per subject significantly
## greater on incongruent trials then they are on
## incongruent trials? Assume equal variance. Ensure an
## expected type I error rate of 0.05.
x <- dd[trial_type == 'incongruent', rt_mean]
y <- dd[trial_type == 'congruent', rt_mean]
t.test(x = x, 
       y = y,
       alternative = c("greater"),
       mu = 0, 
       paired = F, 
       var.equal = T,
       conf.level = 0.95
)

## Do the results of this t-test make sense? Can we be
## confident that we didn't do something careless in our
## coding?

## * t = 2.19 indicates that the difference in the mean
## values between congruent and incongruent trials are just
## a bit more than 2 standard errors apart. We can check
## this, but we need to know what sort of standard error
## this test is / should be using.

## Check for equal sample size
nx <- length(x)
ny <- length(y)

## We do not have equal sample size, and above we are told
## to assume equal variance. We go to the lecture notes to
## find:
sp = sqrt(((nx-1)*var(x) + (ny-1)*var(y)) / (nx + ny - 2)) 
sp_err = sp * sqrt((1/nx) + (1/ny))

## We see that one standard error for this test is about
## 0.09.  

## The difference in means (`mean(x) - mean(y)`) in this
## test is is about .2, which means that we would expect our
## observed t-statistic to be just a bit more than 2. We can 
## check this formally as follows:
t_obs = (mean(x) - mean(y)) / sp_err

## How about the degrees of freedom of this test? Do they
## also check out? From the lecture notes, we expect:
df = nx + ny - 2

## This also lines up with our call to t.test(), but how can
## we be sure we didn't make a mistake wrangling the data?
## How many subjects are in this data set?
d[, length(unique(subject))]

## Each of these subjects should contribute one observation
## to x and one observation to y. Wait... what??? How can we
## have 431 participants and only 425 incongruent
## observations and 246 congruent observations? A good way
## to go about investigating this is to ask how many
## observations in total each subject provides.
dN <- d[, .N, .(subject)][order(N)]
ggplot(data=dN, aes(N)) +
  geom_histogram()

## Ah, we see that quite a few participants didn't complete
## the experiment. It probably makes sense to exlcude these
## people from our analysis.
d[, trials_completed := .N, .(subject)]
d <- d[trials_completed == 30]

## From here, we redo all the above analyses
dd <- d[, 
        .(rt_mean = mean(resp.rt), rt_err = sd(resp.rt)/sqrt(.N)), 
        .(subject, trial_type)]

## Check that each subject gives one observation per trial
## type
dd[, .N, .(subject, trial_type)][, unique(N)]

ggplot(data=dd, aes(x=trial_type, y=rt_mean)) +
  geom_violin() + 
  geom_point()

ddd <- dd[, 
         .(rt_mean = mean(rt_mean), rt_err = sd(rt_mean)/sqrt(.N)),
         .(trial_type)]
ggplot(data=ddd, aes(x=trial_type, y=rt_mean)) +
  geom_pointrange(aes(ymin=rt_mean-rt_err, ymax=rt_mean+rt_err))

x <- dd[trial_type == 'incongruent', rt_mean]
y <- dd[trial_type == 'congruent', rt_mean]
t.test(x = x, 
       y = y,
       alternative = c("greater"),
       mu = 0, 
       paired = F, 
       var.equal = T,
       conf.level = 0.95
)

nx <- length(x)
ny <- length(y)
sp = sqrt(((nx-1)*var(x) + (ny-1)*var(y)) / (nx + ny - 2)) 
sp_err = sp * sqrt((1/nx) + (1/ny))
t_obs = (mean(x) - mean(y)) / sp_err
df = nx + ny - 2
```

